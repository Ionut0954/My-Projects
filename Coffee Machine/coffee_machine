from resources import machine_resources, MENU

def order_price(order):
    return MENU[order]["cost"]

def display_resources():
    print(f'Water: {machine_resources["water"]}ml\n'
          f'Milk: {machine_resources["milk"]}ml\n'
          f'Coffee: {machine_resources["coffee"]}g\n'
          f'Money: ${profit}\n')

def deduct_resources(order):
    for ingredient in MENU[order]["ingredients"]:
        machine_resources[ingredient] -= MENU[order]["ingredients"][ingredient]


def check_quantity(coffee_type, has_resources):
    has_resources = True
    for ingredient in coffee_type:
        if machine_resources[ingredient] < coffee_type[ingredient]:
            has_resources = False
            return has_resources
    return has_resources

espresso_ingredients = MENU["espresso"]["ingredients"]
latte_ingredients = MENU["latte"]["ingredients"]
cappucino_ingredients = MENU["cappucino"]["ingredients"]
profit = machine_resources["money"]
is_power_on = True
has_enough_resources = True
money_inserted = 0
change = 0

while is_power_on:
    order = input("What would you like? (espresso/latte/cappucino): ")

    if order == "espresso":
        has_enough_resources = check_quantity(espresso_ingredients, has_enough_resources)
        if has_enough_resources:
            print("Please insert coins.")
            money_inserted += int(input("How many quarters?: ")) * 0.25
            money_inserted += int(input("How many dimes?: ")) * 0.1
            money_inserted += int(input("How many nickles?: ")) * 0.05
            money_inserted += int(input("How many pennies?: ")) * 0.01
            print(f"Money inserted: ${money_inserted}.")
            if money_inserted >= order_price(order):
                change = money_inserted - order_price(order)
                profit += order_price(order)
                if change > 0:
                    print(f"Here is ${change:.2f} dollars in change.\n")
                    money_inserted = 0
                deduct_resources(order)
                print(f"Here is your {order}. Enjoy!\n")
            else:
                print("Sorry that's not enough money. Money refunded.\n")
                money_inserted = 0
        else:
            print("Sorry there are not enough ingredients.")

    elif order == "latte":
        has_enough_resources = check_quantity(latte_ingredients, has_enough_resources)
        if has_enough_resources:
            print("Please insert coins.")
            money_inserted += int(input("How many quarters?: ")) * 0.25
            money_inserted += int(input("How many dimes? :")) * 0.1
            money_inserted += int(input("How many nickles?: ")) * 0.05
            money_inserted += int(input("How many pennies?: ")) * 0.01
            print(f"Money inserted: ${money_inserted}.")
            if money_inserted >= order_price(order):
                change = money_inserted - order_price(order)
                profit += order_price(order)
                if change > 0:
                    print(f"Here is ${change:.2f} dollars in change.\n")
                    money_inserted = 0
                deduct_resources(order)
                print(f"Here is your {order}. Enjoy!\n")
            else:
                print("Sorry that's not enough money. Money refunded.\n")
                money_inserted = 0
        else:
            print("Sorry there are not enough ingredients.")

    elif order == "cappucino":
        has_enough_resources = check_quantity(cappucino_ingredients, has_enough_resources)
        if has_enough_resources:
            print("Please insert coins.")
            money_inserted += int(input("How many quarters?: ")) * 0.25
            money_inserted += int(input("How many dimes? :")) * 0.1
            money_inserted += int(input("How many nickles?: ")) * 0.05
            money_inserted += int(input("How many pennies?: ")) * 0.01
            print(f"Money inserted: ${money_inserted}.")
            if money_inserted >= order_price(order):
                change = money_inserted - order_price(order)
                profit += order_price(order)
                if change > 0:
                    print(f"Here is ${change:.2f} dollars in change.\n")
                    money_inserted = 0
                deduct_resources(order)
                print(f"Here is your {order}. Enjoy!\n")
            else:
                print("Sorry that's not enough money. Money refunded.\n")
                money_inserted = 0
        else:
            print("Sorry there are not enough ingredients.")

    elif order == "report":
        display_resources()
    elif order == "off":
        print("Shutting Down...")
        is_power_on = False
    else:
        print("Invalid input. Please try again.")
